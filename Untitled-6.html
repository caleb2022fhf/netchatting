<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Messages â€¢ Netless</title>
<style>
* { box-sizing: border-box; }
body { margin:0; font-family:Arial, sans-serif; background:black; color:white; display:flex; height:100vh; }

.sidebar { width:300px; background:#111; overflow-y:auto; display:flex; flex-direction:column; }
.sidebar h2 { margin:10px; font-size:18px; }
.user-card { display:flex; align-items:center; padding:10px; cursor:pointer; border-bottom:1px solid #222; position:relative; }
.user-card:hover { background:#222; }
.avatar { width:40px; height:40px; border-radius:50%; background:#555; margin-right:10px; position:relative; }
.online-indicator { width:10px; height:10px; border-radius:50%; position:absolute; top:15px; right:10px; border:1px solid white; }

.chat-window { flex:1; display:flex; flex-direction:column; background:#000; }
.chat-header { padding:10px; background:#111; border-bottom:1px solid #222; font-weight:bold; display:flex; align-items:center; gap:10px; }
.back-icon { width:40px; height:40px; border-radius:50%; background: linear-gradient(135deg,#00ffff,#ff00ff); display:flex; justify-content:center; align-items:center; cursor:pointer; }
.back-icon svg { width:20px; height:20px; fill:black; }

.chat-messages { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; }
.message { margin-bottom:10px; padding:8px 12px; border-radius:15px; max-width:70%; word-wrap:break-word; position:relative; }
.message span.time { font-size:10px; color:#aaa; position:absolute; bottom:-14px; right:10px; }
.sent { background:#1877f2; color:#fff; align-self:flex-end; }
.received { background:#222; color:#fff; align-self:flex-start; }

.chat-input { display:flex; padding:10px; border-top:1px solid #222; background:#111; }
.chat-input input { flex:1; padding:10px; border-radius:20px; border:none; margin-right:10px; background:#222; color:white; }
.chat-input button { padding:10px 20px; border:none; border-radius:20px; background:#1877f2; color:#fff; cursor:pointer; }

.icons { display:flex; align-items:center; gap:10px; margin-left:auto; }
.icon-btn { width:35px; height:35px; border-radius:50%; background:#222; display:flex; justify-content:center; align-items:center; cursor:pointer; }
.icon-btn:hover { background:#444; }
</style>
</head>
<body>

<div class="sidebar">
  <h2>Chats</h2>
  <div id="usersList"></div>
</div>

<div class="chat-window">
  <div class="chat-header">
    <div class="back-icon" onclick="history.back()">
      <svg viewBox="0 0 24 24"><path d="M15.41 7.41 14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </div>
    <div class="avatar"></div>
    <div id="chatName">Select User</div>
  </div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="chat-input">
    <input type="text" id="chatInput" placeholder="Type a message..." disabled>
    <button id="sendBtn" disabled>Send</button>
  </div>
</div>

<script>
// CURRENT USER
const currentUser = localStorage.getItem('currentUsername') || prompt("Enter your username:");
localStorage.setItem('currentUsername', currentUser);

// USERS LIST (example)
let usersFromUntitled8 = JSON.parse(localStorage.getItem('usersFromUntitled8')) || ["User1","User2","User3"];
usersFromUntitled8 = usersFromUntitled8.filter(u => u!==currentUser); // remove self
const usersList = document.getElementById('usersList');

let activeUser = null;

function renderUsers(){
  usersList.innerHTML='';
  usersFromUntitled8.forEach(name=>{
    const div = document.createElement('div');
    div.className='user-card';
    div.innerHTML=`<div class="avatar"><div class="online-indicator" style="background:green"></div></div>${name}`;
    div.onclick=()=>openChat(name);
    usersList.appendChild(div);
  });
}

// CHAT STORAGE KEY
function getChatKey(user1, user2){
  return 'chat_' + [user1, user2].sort().join('_');
}

// OPEN CHAT
const chatName = document.getElementById('chatName');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');

function openChat(user){
  activeUser=user;
  chatName.textContent=user;
  chatInput.disabled=false;
  sendBtn.disabled=false;
  renderMessages();
}

// RENDER MESSAGES
function renderMessages(){
  if(!activeUser) return;
  const key = getChatKey(currentUser, activeUser);
  const msgs = JSON.parse(localStorage.getItem(key)) || [];
  chatMessages.innerHTML='';
  msgs.forEach(msg=>{
    const div = document.createElement('div');
    div.className = msg.sentBy===currentUser ? 'message sent' : 'message received';
    div.textContent = msg.text;
    const timeSpan = document.createElement('span');
    timeSpan.className='time';
    timeSpan.textContent = msg.time || new Date().toLocaleTimeString();
    div.appendChild(timeSpan);
    chatMessages.appendChild(div);
  });
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

// SEND MESSAGE
function addMessage(text){
  if(!activeUser || !text) return;
  const key = getChatKey(currentUser, activeUser);
  const msgs = JSON.parse(localStorage.getItem(key)) || [];
  const msg = { sentBy: currentUser, text: text, time: new Date().toLocaleTimeString() };
  msgs.push(msg);
  localStorage.setItem(key, JSON.stringify(msgs));
  renderMessages();
}

sendBtn.onclick=()=>{ 
  addMessage(chatInput.value);
  chatInput.value='';
}

// INITIAL RENDER
renderUsers();
</script>

</body>
</html>
